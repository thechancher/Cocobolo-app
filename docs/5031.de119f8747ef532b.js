"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5031],{8933:(_,v,l)=>{l.d(v,{Jb:()=>f,LK:()=>s,ru:()=>g});var g=function(m){return m.Prompt="PROMPT",m.Camera="CAMERA",m.Photos="PHOTOS",m}(g||{}),f=function(m){return m.Rear="REAR",m.Front="FRONT",m}(f||{}),s=function(m){return m.Uri="uri",m.Base64="base64",m.DataUrl="dataUrl",m}(s||{})},1889:(_,v,l)=>{l.d(v,{Wi:()=>f,__:()=>g});var g=function(n){return n.Documents="DOCUMENTS",n.Data="DATA",n.Library="LIBRARY",n.Cache="CACHE",n.External="EXTERNAL",n.ExternalStorage="EXTERNAL_STORAGE",n}(g||{}),f=function(n){return n.UTF8="utf8",n.ASCII="ascii",n.UTF16="utf16",n}(f||{})},5031:(_,v,l)=>{l.r(v),l.d(v,{HomePageModule:()=>U});var g=l(177),f=l(4341),s=l(9364),m=l(1277),n=l(467),P=l(6955),R=l(3349),e=l(4438),I=l(5083),F=l(8933);const S=(0,I.F3)("Camera",{web:()=>l.e(9141).then(l.bind(l,9141)).then(i=>new i.CameraWeb)});var b=l(1889);const p=(0,I.F3)("Filesystem",{web:()=>l.e(2937).then(l.bind(l,2937)).then(i=>new i.FilesystemWeb)});var E=l(4517);let H=(()=>{var i;class d{constructor(a,t,o){this.platform=a,this.loadingCtrl=t,this.toastCtrl=o,this.IMG_DIR="stored-images",this.images=[],this.convertBlobToBase64=c=>new Promise((u,y)=>{const h=new FileReader;h.onerror=y,h.onload=()=>{u(h.result)},h.readAsDataURL(c)})}formatDate(){const a=new Date;return a.getFullYear()+(a.getMonth()+1).toString().padStart(2,"0")+a.getDate()+"_"+a.getHours().toString().padStart(2,"0")+a.getMinutes().toString().padStart(2,"0")+a.getSeconds().toString().padStart(2,"0")}saveImage(a){var t=this;return(0,n.A)(function*(){let o;o=t.platform.is("hybrid")?yield t.readAsBase64_hybrid(a):yield t.readAsBase64_web(a.webPath);const u=t.formatDate()+".jpeg";yield p.writeFile({path:`${t.IMG_DIR}/${u}`,data:o,directory:b.__.Data}),t.loadFiles(),t.presentToast("File saved")})()}updateImage(a){var t=this;return(0,n.A)(function*(){const o=yield t.readAsBase64_web(a.edited),u=t.formatDate()+"_edited.jpeg";yield p.writeFile({path:`${t.IMG_DIR}/${u}`,data:o,directory:b.__.Data}),t.loadFiles(),t.presentToast("File updated")})()}readAsBase64_hybrid(a){return(0,n.A)(function*(){return(yield p.readFile({path:a.path})).data})()}readAsBase64_web(a){var t=this;return(0,n.A)(function*(){const c=yield(yield fetch(a)).blob();return yield t.convertBlobToBase64(c)})()}takeImage(){var a=this;return(0,n.A)(function*(){try{const t=yield S.getPhoto({resultType:F.LK.Uri,source:F.ru.Camera,quality:100});t.webPath&&(yield a.saveImage(t))}catch{console.log("no photo")}})()}loadImage(){var a=this;return(0,n.A)(function*(){try{const t=yield S.getPhoto({resultType:F.LK.Uri,source:F.ru.Photos,quality:100});t&&(yield a.saveImage(t))}catch{console.log("no photo")}})()}loadFiles(){var a=this;return(0,n.A)(function*(){a.images=[];const t=yield a.loadingCtrl.create({message:"loading images..."});yield t.present(),p.readdir({path:a.IMG_DIR,directory:b.__.Data}).then(o=>{a.loadFileData(o.files.map(c=>c.name))},function(){var o=(0,n.A)(function*(c){console.log("error loading: "+c),yield p.mkdir({directory:b.__.Data,path:a.IMG_DIR})});return function(c){return o.apply(this,arguments)}}()).then(o=>{t.dismiss()})})()}loadFileData(a){var t=this;return(0,n.A)(function*(){for(let c of a){const u=`${t.IMG_DIR}/${c}`;var o={detail:"",probability:[]};const y=localStorage.getItem(c);o=null!==y?JSON.parse(y):o;const h=yield p.readFile({path:u,directory:b.__.Data});t.images.unshift({name:c,path:u,data:`data:image/jpeg;base64,${h.data}`,edited:"",details:o})}})()}deleteImage(a){var t=this;return(0,n.A)(function*(){yield p.deleteFile({directory:b.__.Data,path:a.path}),localStorage.removeItem(a.name),t.loadFiles(),t.presentToast("File removed")})()}presentToast(a){var t=this;return(0,n.A)(function*(){(yield t.toastCtrl.create({message:a,duration:3e3})).present()})()}}return(i=d).\u0275fac=function(a){return new(a||i)(e.KVO(E.OD),e.KVO(s.Xi),e.KVO(s.K_))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),d})();var j=l(9350),A=l(7707),T=l(1626);let $=(()=>{var i;class d{constructor(a){this.http=a,this.URL_ROOT="CNN",this.analyzing=!1,this.serverHealth=!0,this.serverError=""}analyze(a){var t=this;return(0,n.A)(function*(){console.log("this.analyzing: ",t.analyzing);const o=yield function D(i,d){const r="object"==typeof d;return new Promise((a,t)=>{const o=new A.Ms({next:c=>{a(c),o.unsubscribe()},error:t,complete:()=>{r?a(d.defaultValue):t(new j.G)}});i.subscribe(o)})}(t.http.post(t.URL_ROOT,{id:123,image:a})).catch(c=>{console.log("reason: ",c),t.serverError=c.message}).finally(()=>{console.log("request finished")});if(o)return o.probs})()}}return(i=d).\u0275fac=function(a){return new(a||i)(e.KVO(T.Qq))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),d})();function k(i,d){1&i&&(e.j41(0,"ion-row")(1,"p"),e.EFF(2,"analyzing..."),e.k0s()())}function C(i,d){if(1&i&&(e.j41(0,"ion-row")(1,"p"),e.EFF(2),e.k0s()()),2&i){const r=e.XpG();e.R7$(2),e.SpI("Error: ",r.serverService.serverError,"")}}function M(i,d){if(1&i&&(e.j41(0,"p")(1,"strong"),e.EFF(2,"Name: "),e.k0s(),e.EFF(3),e.j41(4,"strong"),e.EFF(5,"Probability: "),e.k0s(),e.EFF(6),e.nI1(7,"number"),e.k0s()),2&i){const r=d.$implicit;e.R7$(3),e.SpI("",r.name," "),e.R7$(3),e.SpI("",e.i5U(7,2,r.prob,"0.1-4")," ")}}function G(i,d){if(1&i&&(e.j41(0,"ion-card-content",25)(1,"p")(2,"strong"),e.EFF(3,"Details:"),e.k0s(),e.EFF(4),e.k0s(),e.DNE(5,M,8,5,"p",26),e.k0s()),2&i){const r=e.XpG().$implicit;e.R7$(4),e.JRh(r.details.detail),e.R7$(),e.Y8G("ngForOf",r.details.probability)}}function O(i,d){if(1&i){const r=e.RV6();e.j41(0,"ion-col",14)(1,"ion-card",15),e.nrm(2,"ion-img",16),e.j41(3,"ion-card-header",17)(4,"ion-card-subtitle"),e.EFF(5),e.k0s()(),e.nrm(6,"br"),e.DNE(7,G,6,2,"ion-card-content",18),e.j41(8,"ion-button",19),e.bIt("click",function(){const t=e.eBV(r).$implicit,o=e.XpG();return e.Njj(o.analyze(t))}),e.nrm(9,"ion-icon",20),e.j41(10,"ion-label"),e.EFF(11,"Analyze image"),e.k0s()(),e.j41(12,"ion-button",21),e.bIt("click",function(){const t=e.eBV(r).$implicit,o=e.XpG();return e.Njj(o.editImage(t))}),e.nrm(13,"ion-icon",22),e.j41(14,"ion-label"),e.EFF(15,"Edit image"),e.k0s()(),e.j41(16,"ion-button",21),e.bIt("click",function(){const t=e.eBV(r).$implicit,o=e.XpG();return e.Njj(o.editDetails(t))}),e.nrm(17,"ion-icon",22),e.j41(18,"ion-label"),e.EFF(19,"Edit details"),e.k0s()(),e.j41(20,"ion-button",23),e.bIt("click",function(){const t=e.eBV(r).$implicit,o=e.XpG();return e.Njj(o.deleteImage(t))}),e.nrm(21,"ion-icon",24),e.j41(22,"ion-label"),e.EFF(23,"Remove"),e.k0s()()()()}if(2&i){const r=d.$implicit;e.R7$(2),e.Y8G("src",r.data),e.R7$(3),e.JRh(r.name),e.R7$(2),e.Y8G("ngIf",r.details)}}const z=[{path:"",component:(()=>{var i;class d{constructor(a,t,o){this.cameraService=a,this.serverService=t,this.modalCtrl=o,this.images=[]}ngOnInit(){}loadFiles(){this.cameraService.loadFiles(),this.images=this.cameraService.images}ionViewDidEnter(){this.loadFiles()}takeImage(){var a=this;return(0,n.A)(function*(){yield a.cameraService.takeImage(),a.images=a.cameraService.images})()}loadImage(){var a=this;return(0,n.A)(function*(){yield a.cameraService.loadImage(),a.images=a.cameraService.images})()}editImage(a){var t=this;return(0,n.A)(function*(){const o=yield t.modalCtrl.create({component:P.o,componentProps:{image:a}});return o.onDidDismiss().then(c=>{const u=c.data;null!=u&&t.updateImage(u)}),yield o.present()})()}editDetails(a){var t=this;return(0,n.A)(function*(){return yield(yield t.modalCtrl.create({component:R.P,componentProps:{image:a}})).present()})()}updateImage(a){var t=this;return(0,n.A)(function*(){yield t.cameraService.updateImage(a),t.images=t.cameraService.images})()}deleteImage(a){var t=this;return(0,n.A)(function*(){yield t.cameraService.deleteImage(a),t.images=t.cameraService.images})()}saveProbabilities(a){var t={detail:"",probability:[]};const o=localStorage.getItem(a);(t=null!==o?JSON.parse(o):t).probability=this.probabilities,localStorage.setItem(a,JSON.stringify(t)),this.loadFiles()}analyze(a){var t=this;return(0,n.A)(function*(){var c=a.data.split(",")[1];t.serverService.analyzing?console.log("analyzing..."):(t.serverService.analyzing=!0,t.serverService.serverHealth=!0,t.probabilities=yield t.serverService.analyze(c),t.serverService.analyzing=!1,t.probabilities?(t.serverService.serverHealth=!0,t.saveProbabilities(a.name)):t.serverService.serverHealth=!1)})()}}return(i=d).\u0275fac=function(a){return new(a||i)(e.rXU(H),e.rXU($),e.rXU(s.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-home"]],decls:24,vars:5,consts:[[3,"translucent"],["slot","start"],[3,"fullscreen"],["collapse","condense"],["size","large"],[4,"ngIf"],["size","12","size-Xs","6","size-sm","6","size-Md","3",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed"],["color","wood"],["name","add"],["side","top"],["color","wood-second",3,"click"],["name","attach"],["name","camera"],["size","12","size-Xs","6","size-sm","6","size-Md","3"],["color","wood",2,"padding","0.5em"],["alt","image",2,"height","10em",3,"src"],[2,"padding","0","padding-top","1em"],["style","padding: 0; padding-bottom: 1em;",4,"ngIf"],["expand","full","color","cocobolo",3,"click"],["slot","start","name","search-outline"],["expand","full","color","medium",3,"click"],["slot","start","name","create-outline"],["expand","full","color","danger",3,"click"],["slot","start","name","trash-outline"],[2,"padding","0","padding-bottom","1em"],[4,"ngFor","ngForOf"]],template:function(a,t){1&a&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Home"),e.k0s()()(),e.j41(6,"ion-content",2)(7,"ion-header",3)(8,"ion-toolbar")(9,"ion-title",4),e.EFF(10,"Home"),e.k0s()()(),e.j41(11,"ion-grid"),e.DNE(12,k,3,0,"ion-row",5)(13,C,3,1,"ion-row",5),e.j41(14,"ion-row"),e.DNE(15,O,24,3,"ion-col",6),e.k0s()(),e.j41(16,"ion-fab",7)(17,"ion-fab-button",8),e.nrm(18,"ion-icon",9),e.k0s(),e.j41(19,"ion-fab-list",10)(20,"ion-fab-button",11),e.bIt("click",function(){return t.loadImage()}),e.nrm(21,"ion-icon",12),e.k0s(),e.j41(22,"ion-fab-button",11),e.bIt("click",function(){return t.takeImage()}),e.nrm(23,"ion-icon",13),e.k0s()()()()),2&a&&(e.Y8G("translucent",!0),e.R7$(6),e.Y8G("fullscreen",!0),e.R7$(6),e.Y8G("ngIf",t.serverService.analyzing),e.R7$(),e.Y8G("ngIf",!t.serverService.serverHealth),e.R7$(2),e.Y8G("ngForOf",t.images))},dependencies:[g.Sq,g.bT,s.Jm,s.QW,s.b_,s.I9,s.ME,s.HW,s.hU,s.W9,s.Q8,s.YW,s.OL,s.lO,s.eU,s.iq,s.KW,s.he,s.MC,s.ln,s.BC,s.ai,g.QX]}),d})()}];let N=(()=>{var i;class d{}return(i=d).\u0275fac=function(a){return new(a||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[m.iI.forChild(z),m.iI]}),d})(),U=(()=>{var i;class d{}return(i=d).\u0275fac=function(a){return new(a||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[g.MD,f.YN,s.bv,N]}),d})()}}]);